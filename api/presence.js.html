<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>McLuhan.js Source: media/presence.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.benly.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">McLuhan.js</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Cassette.html">Cassette</a>
						</li>
						
						<li>
							<a href="Film.html">Film</a>
						</li>
						
						<li>
							<a href="Hack.html">Hack</a>
						</li>
						
						<li>
							<a href="Lattice.html">Lattice</a>
						</li>
						
						<li>
							<a href="Manager.html">Manager</a>
						</li>
						
						<li>
							<a href="Medium.html">Medium</a>
						</li>
						
						<li>
							<a href="Paper.html">Paper</a>
						</li>
						
						<li>
							<a href="Photo.html">Photo</a>
						</li>
						
						<li>
							<a href="Presence.html">Presence</a>
						</li>
						
						<li>
							<a href="Rhythm.html">Rhythm</a>
						</li>
						
						<li>
							<a href="Voice.html">Voice</a>
						</li>
						
						<li>
							<a href="Wall.html">Wall</a>
						</li>
						
						<li>
							<a href="Window.html">Window</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: media/presence.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">var util = require('util');

/**
 * @class Presence
 * @constructor
 * @description  Pixilated live video feed of performer
 * @param  {object} Params (see Params)
 * @return {Presence}
 */
var Presence = module.exports = function(params) {

	this.defaultSize = { w: 400, h: 300 }

	this.fps = 10

	this.video = document.createElement("video")
	this.video.style.height = this.defaultSize.h;
	this.video.style.width = this.defaultSize.w;
	this.video.height = this.defaultSize.h;
	this.video.width = this.defaultSize.w;
	this.video.play()

	this.pic = document.createElement('canvas');
	this.pic.style.height = this.defaultSize.h;
	this.pic.style.width = this.defaultSize.w;
	this.pic.width = this.defaultSize.w;
	this.pic.height = this.defaultSize.h;
	this.picctx = this.pic.getContext('2d');

	/* this gets the "presence" canvas in coding.html ...
		if want to send presence through network or add to a Wall,
		will need to generate this second canvas programatically
	*/
	this.canvas = document.getElementById("presence")
	this.canvas.style.height = this.defaultSize.h;
	this.canvas.style.width = this.defaultSize.w;
	this.canvas.width = this.defaultSize.w;
	this.canvas.height = this.defaultSize.h;
	this.context = this.canvas.getContext('2d');


	document.getElementById("main").appendChild(this.canvas)
	
	
	this.localMediaStream = null;
	window.URL = window.URL || window.webkitURL;
	navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia ||
		                          navigator.mozGetUserMedia || navigator.msGetUserMedia;
	
	if (navigator.getUserMedia) {
	  navigator.getUserMedia({audio: false, video: true}, function(stream) {
	        this.video.src = window.URL.createObjectURL(stream);
			this.localMediaStream = stream;
			this.start();
	  }.bind(this),function(e) { console.log(e)}.bind(this));
	}

}

Presence.prototype.snapshot = function(src) {
	this.context.fillStyle = "#eee";
    this.context.fillRect(0,0,this.canvas.width,this.canvas.height)
  if (this.localMediaStream) {
    this.picctx.drawImage(this.video, 0, 0, this.pic.width, this.pic.height);
    this.data = this.picctx.getImageData(0,0,this.pic.width,this.pic.height);
    console.log(this.data);
    var dim = 10
    var w = this.pic.width
    var h = this.pic.height
  /*  for (var i=0;i&lt;this.data;i=i+4) {

  		this.context.fillStyle = "#000";
  		this.context.fillRect(0,0,10,10);
    } */
	for (var i=0;i&lt;30;i++) {
        for (var j=0;j&lt;40;j++) {
          // i means which row
          // j means which column
          //get data, avg, draw shape at right place
          var red = j*4*dim + i*320*4*dim;
          var green = j*4*dim + i*320*4*dim + 1;
          var blue = j*4*dim + i*320*4*dim + 2;
          var placex = j*dim;
          var placey = i*dim; 
          var darkness = this.data.data[red]+this.data.data[green]+this.data.data[blue];
          if (darkness &lt; 300) {
          	//this.context.fillStyle = "rgb("+this.data.data[red]+","+this.data.data[green]+","+this.data.data[blue]+")";
          	this.context.fillStyle = "#04a";
          } else {
			this.context.fillStyle = "#fff";
          }
          this.context.fillRect(placex,placey,dim,dim)
        }
    }
  }
}

Presence.prototype.start = function(src) {
	this.boundSnapshot = this.snapshot.bind(this)
	this.interval = setInterval(this.boundSnapshot,1000/this.fps)
	return this;
}

Presence.prototype.stop = function(rate) {
	clearInterval(this.interval)
}
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					McLuhan.js
					<br />
					
					
		<span class="copyright">
		Ben Taylor &copy; 2015
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Fri May 08 2015 12:14:58 GMT-0500 (CDT) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
