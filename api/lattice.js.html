<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>McLuhan.js Source: media/lattice.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.benly.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">McLuhan.js</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Cassette.html">Cassette</a>
						</li>
						
						<li>
							<a href="Film.html">Film</a>
						</li>
						
						<li>
							<a href="Hack.html">Hack</a>
						</li>
						
						<li>
							<a href="Lattice.html">Lattice</a>
						</li>
						
						<li>
							<a href="Manager.html">Manager</a>
						</li>
						
						<li>
							<a href="Medium.html">Medium</a>
						</li>
						
						<li>
							<a href="Paper.html">Paper</a>
						</li>
						
						<li>
							<a href="Photo.html">Photo</a>
						</li>
						
						<li>
							<a href="Presence.html">Presence</a>
						</li>
						
						<li>
							<a href="Rhythm.html">Rhythm</a>
						</li>
						
						<li>
							<a href="Voice.html">Voice</a>
						</li>
						
						<li>
							<a href="Wall.html">Wall</a>
						</li>
						
						<li>
							<a href="Window.html">Window</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: media/lattice.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">var util = require('util');
var Medium = require('../core/medium')

/**
 * @class Lattice
 * @constructor
 * @description  Interactive PITCH LATTICE
 * @extends Medium
 * @param  {object} Params (see Params)
 * @return {Lattice}
 */
var Lattice = module.exports = function(params) {

	this.defaultSize = { w: 600, h: 600 }
	this.type = "canvas";

	//separate item constructor "Medium" with properties for placement, animation, remove, make dom element, styling element based on json
	Medium.call(this, params);

	this.context = []
	this.instrument = []
	//create 3d matrix
	this.dimension = {
		x: 5,
		y: 8,
		z: 3
	}
	this.place = {
		x: Math.floor(this.dimension.x/2),
		y: Math.floor(this.dimension.y/2),
		z: Math.floor(this.dimension.z/2)
	}

	for (var i = 0; i&lt;this.spaces.length; i++) {
		this.element[i].width = this.defaultSize.w
		this.element[i].height = this.defaultSize.h
		this.instrument[i] = new Object();
		this.instrument[i].context = this.element[i].getContext("2d")	
		this.instrument[i].notes = new Array();
		for (var j = 0; j &lt; this.dimension.z; j++) {
			this.instrument[i].notes[j] = new Array();
			for (var k = 0; k &lt; this.dimension.x; k++) {
				this.instrument[i].notes[j][k] = new Array();
				for (var l = 0; l &lt; this.dimension.y; l++) {
					this.instrument[i].notes[j][k][l] = new this.note(j,k,l,this.instrument[i].context,this.instrument[i],this);
				}
			}
		}
	}

	this.draw();

	return this;

}


/*
	looking at : 5 * 3 * 10
	x: * 3/2
	y: + fundamental of this column, making overtone series
	z: * 5/4
				25/16
				5/4		15/8	45/32
		2/3		1/1		3/2		9/8
				8/5




		2/3 * &lt;=	=> * 3/2
 */


util.inherits(Lattice, Medium);

Lattice.prototype.draw = function(src) {

	for (var i = 0; i&lt;this.instrument.length; i++) {
		var context = this.instrument[i].context
		context.fillStyle="black"
		context.fillRect(0,0,this.defaultSize.w,this.defaultSize.h)
		var notes = this.instrument[i].notes
		for (var j = 0; j &lt; notes.length; j++) {
			for (var k = 0; k &lt; notes[j].length; k++) {
				for (var l = 0; l &lt; notes[j][k].length; l++) {
					notes[j][k][l].draw();
				}
			}
		}
	}


	return this;

}

Lattice.prototype.play = function() {
	this.instrument[0].notes[this.place.z][this.place.x][this.place.y].play()
}
Lattice.prototype.wander = function() {
	this.int = setInterval(this.nextxyz.bind(this),100)
}
Lattice.prototype.nextxyz = function() {
	var dir = random(3)
	if (dir==0) {
		this.place.x += random(3)-1
	} else if (dir==1) {
		this.place.y += random(3)-1
	} else {
		this.place.z += random(3)-1
	}
	this.place.x = this.place.x>=this.dimension.x ? 0 : this.place.x;
	this.place.y = this.place.y>=this.dimension.y ? 0 : this.place.y;
	this.place.z = this.place.z>=this.dimension.z ? 0 : this.place.z;
	this.place.x = this.place.x&lt;0 ? this.dimension.x-1 : this.place.x;
	this.place.y = this.place.y&lt;0 ? this.dimension.y-1 : this.place.y;
	this.place.z = this.place.z&lt;0 ? this.dimension.z-1 : this.place.z;
	this.play()
}
Lattice.prototype.nextx = function() {
	this.place.x++
	this.place.x = this.place.x>=this.dimension.x ? 0 : this.place.x;
	this.place.x = this.place.x&lt;0 ? this.dimension.x : this.place.x;
	this.play()
}
Lattice.prototype.nexty = function() {
	this.place.y++
	this.place.y = this.place.y>=this.dimension.y ? 0 : this.place.y;
	this.place.y = this.place.y&lt;0 ? this.dimension.y : this.place.y;
	this.play()
}
Lattice.prototype.nextz = function() {
	this.place.z++
	this.place.z = this.place.z>=this.dimension.z ? 0 : this.place.z;
	this.place.z = this.place.z&lt;0 ? this.dimension.z : this.place.z;
	this.play()
}


Lattice.prototype.note = function(z,x,y,context,instrument,lattice) {

	this.note = 0.1 * ((x+1)*5/4) * (y+1) * ((z+1)*3/2)
	//this.note = 0.01 * (x*3/2) * y * (z*5/4)
	this.on = false

	this.context = context
	this.instrument = instrument
	this.lattice = lattice

	this.player = new Tone.Player("./media/pnoc3.mp3")
	this.player.retrigger = true
	this.player.playbackRate = this.note
	this.player.toMaster()

	this.x = x
	this.y = y
	this.z = z

	this.place = {
		x: (this.x * 60 + 50) * (1+this.z/12),
		y: (this.y * 50 + 50) * (1+this.z/12)
	}
	this.grd = this.context.createRadialGradient(this.place.x-3,this.place.y-3,3,this.place.x+3,this.place.y+3,20);
	this.grd.addColorStop(0,"rgb("+(180+this.z*40)+","+(180+this.z*40)+","+(180+this.z*40)+")")
	this.grd.addColorStop(1,"#333")

	this.grd2 = this.context.createRadialGradient(this.place.x-3,this.place.y-3,3,this.place.x+3,this.place.y+3,20);
	this.grd2.addColorStop(0,"rgb("+(0+this.z*40)+","+(0+this.z*40)+","+(180+this.z*40)+")")
	this.grd2.addColorStop(1,"#0af")

	this.draw = function() {

		//j is z
		//k is x
		//l is y
		if (this.on) {
			this.context.fillStyle = this.grd2
		} else {
			this.context.fillStyle = this.grd
		}
		this.context.beginPath()
		this.context.arc(this.place.x,this.place.y,8+this.z*2,0,Math.PI*2,false)
		this.context.fill()
		this.context.closePath()

	}

	this.play = function() {
		this.on = true;
		this.player.onended = function() {
			this.on = false
			this.lattice.draw();
		}.bind(this)
		this.player.start();
		//currently redraws *all* lattices in all windows. should only draw its own instrument.
		this.lattice.draw();
	}

	this.stop = function() {
		this.on = false;
		this.player.stop();
		this.lattice.draw();

	}


}

</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					McLuhan.js
					<br />
					
					
		<span class="copyright">
		Ben Taylor &copy; 2015
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Sat Apr 11 2015 13:33:52 GMT-0500 (CDT) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
